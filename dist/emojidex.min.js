/*
 *  jQuery Emojidex - v0.1.0
 *  emojidex coffee plugin for jQuery/Zepto and compatible
 *  https://github.com/Genshin/emojidex-coffee#emojidex-coffee
 *
 *  Made by Genshin
 *  Under LGPL License
 */
(function(){!function(a,b,c){var d,e,f;return f="emojidex",e={emojiarea:{plaintext:"emojidex-plaintext",wysiwyg:"emojidex-wysiwyg",value_output:"emojidex-rawtext"}},d=function(){function b(b,c){this.element=b,this.options=a.extend({},e,c),this._defaults=e,this._name=f,this.loadEmojidexJSON(this.element,this.options),this.setEmojiarea(this.options)}return b.prototype.loadEmojidexJSON=function(c,d){return a.emojiarea.path=d.path_img,a.getJSON(d.path_json,function(d){var e;return d=b.prototype.getCategorizedData(d),a.emojiarea.icons=d,e=b.prototype.setEmojiCSS_getEmojiRegexps(d),b.prototype.setEmojiIcon(d,c,e)})},b.prototype.getCategorizedData=function(a){var b,c,d,e;for(c={},d=0,e=a.length;e>d;d++)b=a[d],null==c[b.category]?c[b.category]=[b]:c[b.category].push(b);return c},b.prototype.setEmojiCSS_getEmojiRegexps=function(c){var d,e,f,g,h,i,j,k,l;j="",i=":(",g=a('<style type="text/css" />');for(e in c)for(h=c[e],k=0,l=h.length;l>k;k++)f=h[k],j+=f.moji+"|",i+=f.code+"|",d=b.prototype.loadImageFromLocalStorage(f.code),g.append(d?"i.emojidex-"+f.moji+" {background-image: url('"+d+"')}":"i.emojidex-"+f.moji+" {background-image: url('"+a.emojiarea.path+f.code+".svg')}");return a("head").append(g),[j.slice(0,-1),i.slice(0,-1)+"):"]},b.prototype.loadImageFromLocalStorage=function(a){var c;return localStorage?(c=localStorage.getItem(a),c?c:(b.prototype.setImageToLocalStorage(a),null)):null},b.prototype.setImageToLocalStorage=function(b){var d,e;return d=c.createElement("canvas"),d&&d.getContext&&d.getContext("2d")?(e=new Image,e.src=a.emojiarea.path+b+".svg",e.onload=function(){var a;d=c.createElement("canvas"),d.width=this.width,d.height=this.height,d.getContext("2d").drawImage(this,0,0),a=d.toDataURL(),localStorage.setItem(b,a)}):void 0},b.prototype.setEmojiIcon=function(b,c,d){var e,f,g;return e=function(a){return'<i class="emojidex-'+a+'"></i>'},g=function(a,b){return a=a.replace(new RegExp(b,"g"),function(a){return e(a)})},f=function(a,b,c){return a=a.replace(new RegExp(b,"g"),function(a){var b,d,f,g,h;a=a.replace(/:/g,"");for(b in c)for(h=c[b],f=0,g=h.length;g>f;f++)if(d=h[f],d.code===a)return e(d.moji)})},a(c).find(":not(iframe,textarea,script)").andSelf().contents().filter(function(){return this.nodeType===Node.TEXT_NODE}).each(function(){var c;return c=this.textContent,c=g(c,d[0]),c=f(c,d[1],b),a(this).replaceWith(c)})},b.prototype.setEmojiarea=function(b){return b.emojiarea.plaintext.emojiarea({wysiwyg:!1}),b.emojiarea.wysiwyg.on("change",function(){return b.emojiarea.value_output.text(a(this).val())}),b.emojiarea.wysiwyg.trigger("change")},b.prototype.prepareAutoComplete=function(b,c){var d,e,f,g,h,i,j;g=[];for(d in b)for(j=b[d],h=0,i=j.length;i>h;h++)e=j[h],g.push(e.code);return g=a.map(g,function(a){return{key:a,name:a}}),f={at:":",data:g,tpl:"<li data-value=':${key}:'><img src='../src/assets/img/utf/${name}.svg'  height='20' width='20' /> ${name}</li>",insert_tpl:"<img src='../src/assets/img/utf/${name}.svg' height='20' width='20' />"},c.emojiarea.plaintext.atwho(f),c.emojiarea.wysiwyg.atwho(f)},b}(),a.fn[f]=function(b){return this.each(function(){return a.data(this,"plugin_"+f)?void 0:a.data(this,"plugin_"+f,new d(this,b))})}}(jQuery,window,document)}).call(this);